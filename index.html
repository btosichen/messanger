<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatMew å–µå–µèŠ</title>
    <style>
        /* * =========================================
         * CSS è®Šæ•¸è¨­å®š (é…è‰²ä¸»é¡Œ)
         * =========================================
         */
        :root {
            /* æ·ºè‰²ä¸»é¡Œ (é è¨­) - æŸ”å’Œå¯æ„›é¢¨ */
            --bg-color: #fff0f5; /* æ·ºç²‰èƒŒæ™¯ */
            --header-bg: #ffb7c5; /* header ç²‰è‰² */
            --header-text: #5e3a45;
            --chat-area-bg: #fff0f5;
            --input-area-bg: #ffffff;
            --input-border: #ffd1dc;
            
            /* è¨Šæ¯æ°£æ³¡ */
            --bubble-me-bg: #8ec5fc; /* è‡ªå·±çš„è¨Šæ¯ (ç²‰è—) */
            --bubble-me-text: #2c3e50;
            --bubble-friend-bg: #ffffff; /* å°æ–¹çš„è¨Šæ¯ (ç™½) */
            --bubble-friend-text: #444;
            --bubble-shadow: 0 4px 6px rgba(0,0,0,0.05);

            /* æŒ‰éˆ•èˆ‡äº’å‹• */
            --btn-primary: #ff9a9e;
            --btn-hover: #ff758c;
            --text-meta: #888; /* æ™‚é–“æ–‡å­—é¡è‰² */
        }

        /* æ·±è‰²ä¸»é¡Œ */
        .dark-mode {
            --bg-color: #1a1a2e;
            --header-bg: #16213e;
            --header-text: #e94560;
            --chat-area-bg: #1a1a2e;
            --input-area-bg: #0f3460;
            --input-border: #533483;

            /* è¨Šæ¯æ°£æ³¡ */
            --bubble-me-bg: #e94560; /* è‡ªå·±çš„è¨Šæ¯ (éœ“è™¹ç´…) */
            --bubble-me-text: #fff;
            --bubble-friend-bg: #2a2a40; /* å°æ–¹çš„è¨Šæ¯ (æ·±ç°è—) */
            --bubble-friend-text: #eee;
            --bubble-shadow: 0 4px 6px rgba(0,0,0,0.3);

            --btn-primary: #e94560;
            --btn-hover: #ff2e63;
            --text-meta: #aaa;
        }

        /* * =========================================
         * å…¨åŸŸè¨­å®š & ç‰ˆé¢é…ç½®
         * =========================================
         */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: "Microsoft JhengHei", "PingFang TC", sans-serif;
            transition: background-color 0.3s, color 0.3s; /* å¹³æ»‘çš„ä¸»é¡Œåˆ‡æ›æ•ˆæœ */
        }

        body {
            background-color: var(--bg-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* é˜²æ­¢æ•´å€‹é é¢æ²å‹•ï¼Œåªæ²å‹•å°è©±å€ */
        }

        /* * =========================================
         * Header (æ¨™é¡Œåˆ—)
         * =========================================
         */
        header {
            background-color: var(--header-bg);
            color: var(--header-text);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 10;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .back-btn {
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .user-status {
            font-size: 0.8rem;
            opacity: 0.8;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background-color: #2ecc71; /* ç¶ è‰²ç‡ˆè™Ÿ */
            border-radius: 50%;
            display: inline-block;
        }

        .header-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: inherit;
            padding: 5px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .icon-btn:hover {
            background-color: rgba(255,255,255,0.2);
        }

        /* SVG åœ–ç¤ºå¤§å° */
        svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        /* * =========================================
         * Main (å°è©±å€)
         * =========================================
         */
        main {
            flex: 1; /* ä½”æ»¿å‰©é¤˜ç©ºé–“ */
            background-color: var(--chat-area-bg);
            padding: 20px;
            overflow-y: auto; /* å…§å®¹éå¤šæ™‚æ²å‹• */
            display: flex;
            flex-direction: column;
            gap: 20px;
            scroll-behavior: smooth;
        }

        /* å°è©±æ°£æ³¡å®¹å™¨ */
        .message-row {
            display: flex;
            align-items: flex-end; /* å°é½Šåº•éƒ¨ */
            gap: 10px;
            max-width: 85%;
            animation: fadeIn 0.3s ease-out; /* é€²å ´å‹•ç•« */
        }

        /* è‡ªå·± (å³é‚Š) */
        .message-row.me {
            align-self: flex-end;
            flex-direction: row-reverse; /* åè½‰æ’åˆ—ï¼šå¤§é ­è²¼åœ¨æœ€å³ */
        }

        /* å°æ–¹ (å·¦é‚Š) */
        .message-row.friend {
            align-self: flex-start;
        }

        /* å¤§é ­è²¼ */
        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: #ddd;
            overflow: hidden;
            flex-shrink: 0;
            border: 2px solid rgba(255,255,255,0.5);
        }
        
        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* è¨Šæ¯å…§å®¹å€å¡Š (åŒ…å«åå­—ã€æ°£æ³¡ã€æ™‚é–“) */
        .message-content {
            display: flex;
            flex-direction: column;
        }

        .sender-name {
            font-size: 0.75rem;
            color: var(--text-meta);
            margin-bottom: 4px;
        }
        
        .me .sender-name {
            text-align: right;
            display: none; /* é€šå¸¸è‡ªå·±çš„è¨Šæ¯ä¸é¡¯ç¤ºåå­—ï¼Œä¿æŒç°¡æ½” */
        }

        .bubble {
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 0.95rem;
            line-height: 1.4;
            position: relative;
            box-shadow: var(--bubble-shadow);
            word-wrap: break-word;
        }

        /* è‡ªå·±çš„æ°£æ³¡æ¨£å¼ */
        .me .bubble {
            background-color: var(--bubble-me-bg);
            color: var(--bubble-me-text);
            border-bottom-right-radius: 4px; /* å³ä¸‹è§’å°–è§’ */
        }

        /* å°æ–¹çš„æ°£æ³¡æ¨£å¼ */
        .friend .bubble {
            background-color: var(--bubble-friend-bg);
            color: var(--bubble-friend-text);
            border-bottom-left-radius: 4px; /* å·¦ä¸‹è§’å°–è§’ */
        }

        .message-time {
            font-size: 0.7rem;
            color: var(--text-meta);
            margin-top: 4px;
        }

        .me .message-time {
            text-align: right;
        }

        /* é€²å ´å‹•ç•« Keyframe */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* * =========================================
         * Footer (è¼¸å…¥å€)
         * =========================================
         */
        footer {
            background-color: var(--input-area-bg);
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-top: 1px solid rgba(0,0,0,0.05);
        }

        .input-group {
            flex: 1;
            display: flex;
            background-color: var(--bg-color); /* è®“è¼¸å…¥æ¡†èƒŒæ™¯è·Ÿéš¨ä¸»é¡Œå¾®èª¿ */
            border-radius: 25px;
            padding: 5px 15px;
            border: 2px solid var(--input-border);
            align-items: center;
        }

        input[type="text"] {
            flex: 1;
            border: none;
            background: transparent;
            padding: 10px 5px;
            outline: none;
            font-size: 1rem;
            color: var(--header-text);
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        .send-btn {
            background-color: var(--btn-primary);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.1s, background-color 0.2s;
        }

        .send-btn:active {
            transform: scale(0.9);
        }
        
        .send-btn:hover {
            background-color: var(--btn-hover);
        }
        
        .emoji-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            color: #888;
            padding-right: 5px;
        }

        /* æ²è»¸ç¾åŒ– (Webkit browsers) */
        main::-webkit-scrollbar {
            width: 6px;
        }
        main::-webkit-scrollbar-thumb {
            background-color: rgba(0,0,0,0.1);
            border-radius: 3px;
        }
        .dark-mode main::-webkit-scrollbar-thumb {
            background-color: rgba(255,255,255,0.1);
        }

    </style>
</head>
<body>

    <!-- 1. é ‚éƒ¨æ¨™é¡Œåˆ— -->
    <header>
        <div class="header-left">
            <div class="back-btn">
                <!-- SVG: è¿”å›ç®­é ­ -->
                <svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
            </div>
            <div class="user-info">
                <div class="user-name">é˜¿å–µ ğŸ±</div>
                <div class="user-status">
                    <span class="status-dot"></span> åœ¨ç·šä¸Š
                </div>
            </div>
        </div>
        <div class="header-right">
            <!-- ä¸»é¡Œåˆ‡æ›æŒ‰éˆ• -->
            <button class="icon-btn" id="theme-toggle" title="åˆ‡æ›ä¸»é¡Œ">
                <!-- é è¨­é¡¯ç¤ºæœˆäº® (ä»£è¡¨é»äº†è®Šæ·±è‰²) -->
                <svg id="theme-icon" viewBox="0 0 24 24"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-3.03 0-5.5-2.47-5.5-5.5 0-1.82.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/></svg>
            </button>
            <!-- è¨­å®šæŒ‰éˆ• (è£é£¾ç”¨) -->
            <button class="icon-btn">
                <svg viewBox="0 0 24 24"><path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>
            </button>
        </div>
    </header>

    <!-- 2. ä¸­é–“å°è©±å€ -->
    <main id="chat-box">
        <!-- é€™è£¡çš„è¨Šæ¯æœƒç”± JavaScript å‹•æ…‹ç”Ÿæˆï¼Œé è¨­å…ˆæ”¾ä¸€äº›ç¯„ä¾‹ -->
    </main>

    <!-- 3. åº•éƒ¨è¼¸å…¥å€ -->
    <footer>
        <div class="input-group">
            <button class="emoji-btn">ğŸ˜Š</button>
            <input type="text" id="message-input" placeholder="è¼¸å…¥è¨Šæ¯..." autocomplete="off">
        </div>
        <button class="send-btn" id="send-btn">
            <!-- SVG: ç´™é£›æ©Ÿ -->
            <svg viewBox="0 0 24 24" style="margin-left: -2px; width: 20px; height: 20px;"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
        </button>
    </footer>

    <!-- éš±è—çš„éŸ³æ•ˆæ¨™ç±¤ (Base64 ç·¨ç¢¼çš„çŸ­ä¿ƒæ°£æ³¡éŸ³) -->
    <audio id="send-sound">
        <source src="data:audio/mp3;base64,//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NExAAAAANIAAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq" type="audio/mp3">
    </audio>

    <script>
        // DOM å…ƒç´ é¸å–
        const chatBox = document.getElementById('chat-box');
        const messageInput = document.getElementById('message-input');
        const sendBtn = document.getElementById('send-btn');
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');
        const sendSound = document.getElementById('send-sound');

        // é è¨­çš„æ©Ÿå™¨äººå›è¦†è³‡æ–™åº«
        const botReplies = [
            "çœŸçš„å—ï¼Ÿå¤ªé…·äº†å§ï¼ ğŸ˜²",
            "å·²æ”¶åˆ°ä½ çš„è¨Šæ¯ ğŸ˜„",
            "é€™é€±æœ«è¦ä¸è¦ä¸€èµ·å»åƒç«é‹ï¼Ÿ ğŸ²",
            "å“ˆå“ˆå“ˆå“ˆï¼Œç¬‘æ­»æˆ‘äº† ğŸ˜‚",
            "å—¯å—¯ï¼Œæˆ‘æ­£åœ¨è½ã€‚",
            "é€™å¼µåœ–å¥½å¯æ„›å–”ï¼ â¤ï¸",
            "ç¨ç­‰æˆ‘ä¸€ä¸‹ï¼Œæˆ‘å…ˆå»æ´—æ¾¡ ğŸ›"
        ];

        // å‡çš„å¤§é ­è²¼ URL (ä½¿ç”¨ Placehold.co ç”Ÿæˆç°¡å–®çš„å¸¶å­—åœ“åœ–)
        const myAvatarUrl = 'https://ui-avatars.com/api/?name=Me&background=8ec5fc&color=fff&rounded=true';
        const friendAvatarUrl = 'https://ui-avatars.com/api/?name=Cat&background=ffb7c5&color=fff&rounded=true';

        // åˆå§‹åŒ–ï¼šè¼‰å…¥ç¯„ä¾‹è¨Šæ¯
        window.onload = function() {
            addMessage('friend', 'å—¨ï¼ä½ å¥½å—ï¼Ÿ ğŸ‘‹');
            setTimeout(() => {
                addMessage('friend', 'ä»Šå¤©è¦ä¸è¦å‡ºä¾†ç©ï¼Ÿ');
            }, 500);
        };

        // 1. æ–°å¢è¨Šæ¯çš„æ ¸å¿ƒå‡½å¼
        function addMessage(sender, text) {
            // å»ºç«‹è¨Šæ¯åˆ—å®¹å™¨
            const row = document.createElement('div');
            row.classList.add('message-row', sender); // sender: 'me' or 'friend'

            // 1. å¤§é ­è²¼
            const avatarDiv = document.createElement('div');
            avatarDiv.classList.add('avatar');
            const avatarImg = document.createElement('img');
            avatarImg.src = sender === 'me' ? myAvatarUrl : friendAvatarUrl;
            avatarDiv.appendChild(avatarImg);

            // 2. è¨Šæ¯å…§å®¹ (åå­—ã€æ°£æ³¡ã€æ™‚é–“)
            const contentDiv = document.createElement('div');
            contentDiv.classList.add('message-content');

            // åå­— (åªæœ‰å°æ–¹é¡¯ç¤ºï¼Œè‡ªå·±éš±è—)
            if (sender === 'friend') {
                const nameDiv = document.createElement('div');
                nameDiv.classList.add('sender-name');
                nameDiv.innerText = 'é˜¿å–µ ğŸ±';
                contentDiv.appendChild(nameDiv);
            }

            // æ°£æ³¡
            const bubbleDiv = document.createElement('div');
            bubbleDiv.classList.add('bubble');
            bubbleDiv.innerText = text;

            // æ™‚é–“
            const timeDiv = document.createElement('div');
            timeDiv.classList.add('message-time');
            timeDiv.innerText = getCurrentTime();

            // çµ„è£å…§å®¹å€
            contentDiv.appendChild(bubbleDiv);
            contentDiv.appendChild(timeDiv);

            // æ ¹æ“šç™¼é€è€…æ±ºå®š DOM é †åº (å…¶å¯¦ CSS row-reverse å·²ç¶“è™•ç†äº† me çš„è¦–è¦ºé †åºï¼Œä½† DOM çµæ§‹æˆ‘å€‘çµ±ä¸€)
            // ç‚ºäº† CSS Flex çš„é€šç”¨æ€§ï¼Œæˆ‘å€‘ç¶­æŒï¼šAvatar + Content
            row.appendChild(avatarDiv);
            row.appendChild(contentDiv);

            // åŠ å…¥èŠå¤©å®¤
            chatBox.appendChild(row);

            // è‡ªå‹•æ²åˆ°åº•éƒ¨
            scrollToBottom();
        }

        // 2. æ²å‹•åˆ°åº•éƒ¨å‡½å¼
        function scrollToBottom() {
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // 3. å–å¾—ç›®å‰æ™‚é–“ (æ ¼å¼ 10:30 PM)
        function getCurrentTime() {
            const now = new Date();
            let hours = now.getHours();
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const ampm = hours >= 12 ? 'PM' : 'AM';
            
            hours = hours % 12;
            hours = hours ? hours : 12; // 0 è®Šæˆ 12
            
            return `${hours}:${minutes} ${ampm}`;
        }

        // 4. è™•ç†ç™¼é€è¨Šæ¯
        function handleSend() {
            const text = messageInput.value.trim();
            if (text === "") return;

            // ç™¼é€è‡ªå·±çš„è¨Šæ¯
            addMessage('me', text);
            messageInput.value = ""; // æ¸…ç©ºè¼¸å…¥æ¡†
            messageInput.focus();

            // æ’­æ”¾éŸ³æ•ˆ (è™•ç†ç€è¦½å™¨è‡ªå‹•æ’­æ”¾é™åˆ¶ï¼Œé€šå¸¸éœ€è¦äº’å‹•å¾Œæ‰èƒ½æ’­)
            try {
                sendSound.currentTime = 0;
                sendSound.play().catch(e => console.log('Audio play failed (interaction needed):', e));
            } catch (e) {
                // å¿½ç•¥éŒ¯èª¤
            }

            // æ¨¡æ“¬æ©Ÿå™¨äººå›è¦† (å»¶é² 1~1.5 ç§’)
            setTimeout(() => {
                const randomReply = botReplies[Math.floor(Math.random() * botReplies.length)];
                addMessage('friend', randomReply);
            }, 1000 + Math.random() * 500);
        }

        // 5. äº‹ä»¶ç›£è½
        // é»æ“Šç™¼é€æŒ‰éˆ•
        sendBtn.addEventListener('click', handleSend);

        // è¼¸å…¥æ¡†æŒ‰ä¸‹ Enter
        messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                handleSend();
            }
        });

        // 6. ä¸»é¡Œåˆ‡æ›é‚è¼¯
        let isDarkMode = false;
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            isDarkMode = !isDarkMode;

            // åˆ‡æ›åœ–ç¤º (SVG path)
            if (isDarkMode) {
                // è®Šæˆå¤ªé™½åœ–ç¤º
                themeIcon.innerHTML = '<path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.79 1.42-1.41zM4 10.5H1v2h3v-2zm9-9.95h-2V3.5h2V.55zm7.45 3.91l-1.41-1.41-1.79 1.79 1.41 1.41 1.79-1.79zm-3.21 13.7l1.79 1.8 1.41-1.41-1.8-1.79-1.4 1.4zM20 10.5v2h3v-2h-3zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm-1 16.95h2V19.5h-2v2.95zm-7.45-3.91l1.41 1.41 1.79-1.8-1.41-1.41-1.79 1.8z"/>';
            } else {
                // è®Šå›æœˆäº®åœ–ç¤º
                themeIcon.innerHTML = '<path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-3.03 0-5.5-2.47-5.5-5.5 0-1.82.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/>';
            }
        });

    </script>
</body>
</html>
